## [04-Работаем с сообщениями через очередь](#) 

Очереди очень полезны для безопасной передачи сообщений от одной задачи к другой. Обмен сообщениями между задачами выполняется по правилу FIFO (первым сообщение пришло -  первым и уйдет), то есть новые данные добавляются в конец очереди и извлекаются из начала.

### Нумераторы (перечисления)

Для работы с enumerator в Arduino можно использовать два подхода: 

#### Стандартные перечисления 

В этом случае перечисления используются как значения (целое число с уникальным именем). Чтобы использовать перечисление, нужно вызвать значение напрямую (например, Value_1) или через объект перечисления (например, Sample::Value_1). Если перечисление объявлено в отдельном файле, необходимо включить объявление заголовка в начало файла .ino или .cpp. 

#### Перечисления с пространством имён. 

В проекте объявляется пространство имён, и внутри него объявляется значение перечисления. Перечисления должны иметь уникальные имена, даже если они находятся в отдельных пространствах имён. Чтобы использовать перечисление, нужно вызвать пространство имён, за которым следует значение (например, NameSpace::EnumName::Value_1) или пространство имён, за которым следует перечисление и значение (например, NameSpace::EnumName::Value_1). 

Также порядок автоматической нумерации можно изменить, задав начальное значение. От него всё будет и дальше изменяться на единицу. 

#### [Структуры и перечисления](https://alexgyver.ru/lessons/struct/)

#### [How to create and use enums in Arduino](https://www.delasign.com/blog/how-to-create-and-use-enums-in-arduino/)

```
1970-01-01,00:00:06 NOTICE-ISR[0] Передано 3 сообщение из прерывания
Общий размер ВСТРОЕННОЙ памяти:     370524
Оставшаяся доступная память в куче: 332868
Минимальная свободная с загрузки:   327164
Общий размер SPI PSRAM:             4194304
Количество свободной PSRAM:         4192124
Минимум свободной SPI PSRAM:        4192124
Самый большой блок для выделения:   4128756


1970-01-01,00:00:46 NOTICE-ISR[0] Передано 23 сообщение из прерывания
Общий размер ВСТРОЕННОЙ памяти:     370524
Оставшаяся доступная память в куче: 332868
Минимальная свободная с загрузки:   327164
Общий размер SPI PSRAM:             4194304
Количество свободной PSRAM:         4192124
Минимум свободной SPI PSRAM:        4192124
Самый большой блок для выделения:   4128756

-----------------------------

1970-01-01,00:00:06 NOTICE-ISR[0] Передано 3 сообщение из прерывания
Общий размер ВСТРОЕННОЙ памяти:     370524
Оставшаяся доступная память в куче: 332868
Минимальная свободная с загрузки:   326892
Общий размер SPI PSRAM:             4194304
Количество свободной PSRAM:         4192124
Минимум свободной SPI PSRAM:        4192124
Самый большой блок для выделения:   4128756

1970-01-01,00:00:44 NOTICE-ISR[0] Передано 22 сообщение из прерывания
Общий размер ВСТРОЕННОЙ памяти:     370524
Оставшаяся доступная память в куче: 332868
Минимальная свободная с загрузки:   326892
Общий размер SPI PSRAM:             4194304
Количество свободной PSRAM:         4192124
Минимум свободной SPI PSRAM:        4192124
Самый большой блок для выделения:   4128756
----------------
1970-01-01,00:00:51 NOTICE-QHM[4] Максимально длинное сообщение из 255 байт [буфер текстов сообщений максимально может содержать 255 байт и завершающий ноль
1970-01-01,00:00:52 NOTICE-QHM[1] Передано 28 сообщение из задачи на 51785 миллисекунде
1970-01-01,00:00:52 NOTICE-ISR[0] Передано 26 сообщение из прерывания

1970-01-01,00:00:51 NOTICE-QHM[4] Максимально длинное сообщение из 255 байт [буфер текстов сообщений максимально может содержать 255 байт и завершающий ноль
1970-01-01,00:00:52 NOTICE-QHM[1] Передано 28 сообщение из задачи на 51783 миллисекунде
1970-01-01,00:00:52 NOTICE-ISR[0] Передано 26 сообщение из прерывания
```

### Библиография

#### [Queue Management](https://www.freertos.org/Documentation/02-Kernel/04-API-references/06-Queues/00-QueueManagement)

#### [FreeRTOS queues](https://www.freertos.org/Documentation/02-Kernel/02-Kernel-features/02-Queues-mutexes-and-semaphores/01-Queues)

#### [Очереди FreeRTOS](https://kotyara12.ru/iot/esp32_queue/)

#### [ESP32 Arduino: FreeRTOS Queues](https://techtutorialsx.com/2017/08/20/esp32-arduino-freertos-queues/)

###### [к содержанию](#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5---%D0%B1%D1%8B%D1%81%D1%82%D1%80%D0%BE%D0%B5-%D0%B7%D0%BD%D0%B0%D0%BA%D0%BE%D0%BC%D1%81%D1%82%D0%B2%D0%BE)
